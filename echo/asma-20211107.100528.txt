ASMA Ver. 0.2.1                                                                                     07 Nov 2021 10:05:28  Page     1

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                               1 * Copyright 2021 Harold Grovesteen
                                               2 *
                                               3 * MIT License:
                                               4 *
                                               5 * Permission is hereby granted, free of charge, to any person obtaining a copy
                                               6 * of this software and associated documentation files (the "Software"), to deal
                                               7 * in the Software without restriction, including without limitation the rights
                                               8 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
                                               9 * copies of the Software, and to permit persons to whom the Software is
                                              10 * furnished to do so, subject to the following conditions:
                                              11 *
                                              12 * The above copyright notice and this permission notice shall be included in
                                              13 * all copies or substantial portions of the Software.
                                              14 *
                                              15 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
                                              16 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
                                              17 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
                                              18 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
                                              19 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
                                              20 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
                                              21 * THE SOFTWARE.
                                              22
ASMA Ver. 0.2.1  ECHO - CONSOLE ECHO TEST                                                           07 Nov 2021 10:05:28  Page     2

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                              24 * Program Description:
                                              25 *
                                              26 * ECHO is a bare-metal program.  It requires input/output commands to
                                              27 * the system's console device.  It's purpose is to exercise the console
                                              28 * device.
                                              29 *
                                              30 * The program is executed by means of an IPL from a card deck. Initially
                                              31 * a line is diplayed explaining the use of the program.  Following this
                                              32 * a prompt is displayed with the keyboard unlocked for user input.
                                              33 * Whatever is typed is then printed on the next line.  This is followed by the
                                              34 * prompt with user input expected until the user enters 'quit' in lower case.
                                              35 * without quotes.  quit terminates the program normally.
                                              36 *
                                              37 * The system interrupt key or console 'cancel' key will interrupt the
                                              38 * executing program.  Display a message.  And then return to the normal
                                              39 * echo functions described above.
                                              40 *
                                              41 * Target Platform: SimH
                                              42 * Target Architecture: S/360
                                              43 *
                                              44 * Devices Used:
                                              45 *   01F - Console device
                                              46 *
                                              47 * Program Register Usage:

                            000000  000001    49 R0       EQU   0   Base register for access to the ASA. Required by DSECT
                                              50 *                  usage, but available for program usage
                            000001  000001    51 R1       EQU   1   Device Channel and Unit Address for I/O instructions
                            000002  000001    52 R2       EQU   2   I/O Routine Channel-Address Word
                            000003  000001    53 R3       EQU   3   Length of data received from the operator
                            000004  000001    54 R4       EQU   4   available
                            000005  000001    55 R5       EQU   5   available
                            000006  000001    56 R6       EQU   6   available
                            000007  000001    57 R7       EQU   7   available
                            000008  000001    58 R8       EQU   8   available
                            000009  000001    59 R9       EQU   9   available
                            00000A  000001    60 R10      EQU   10  available
                            00000B  000001    61 R11      EQU   11  Contains zero for STATUS clearing (zero'd from CPU reset).
                            00000C  000001    62 R12      EQU   12  The global program base register
                            00000D  000001    63 R13      EQU   13  External Interruption R15 save register
                            00000E  000001    64 R14      EQU   14  I/O Routine return register.  Program is the caller
                            00000F  000001    65 R15      EQU   15  Subroutine return register.  I/O routine is the caller

                                              67 * Disabled Wait State PSW's address field values used by the program:
                                              68 *    X'000000' - Successful execution of the program
                                              69 * Note: Restart interruptions are not available on S/360 systems.
                                              70 *    X'000018' - Unexpected External interruption occurred.
                                              71 *                Old External PSW at address X'18'
                                              72 *    X'000020' - Unexpected Supervisor interruption occurred.
                                              73 *                Old Supervisor PSW at address X'20'
                                              74 *    X'000028' - Unexpected Program interruption occurred.
                                              75 *                Old Program PSW address X'28'
ASMA Ver. 0.2.1  ECHO - CONSOLE ECHO TEST                                                           07 Nov 2021 10:05:28  Page     3

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                              76 *    X'000030' - Unexpected Machine Check interruption occurred.
                                              77 *                Old Machine Check PSW at address X'30'
                                              78 *    X'000038' - Unexpected Input/Output interruption occurred.
                                              79 *                Old Input/Output PSW at address X'38'
                                              80 *    X'1xccuu' - Device or channel not operational. ccuu=Device Address
                                              81 *    X'2xccuu' - Device or channel busy.            ccuu=Device Address
                                              82 *    X'3xccuu' - Device storing of CSW missed       ccuu=Device Address
                                              83 *    X'4xccuu' - Unexpected device interruption.    ccuu=Device Address
                                              84 *    X'5xddcc' - Console Status problem.  dd=device status, cc=channel status
                                              85 *    X'6x00ss' - Console Device sense data.  ss=general sense byte
                                              86 *                Sense data reporting is not yet enabled.
                                              87 * Note: The 'x' in the above wait state codes indicates the program position
                                              88 * in which the error was detected.
ASMA Ver. 0.2.1  ECHO - CONSOLE ECHO TEST                                                           07 Nov 2021 10:05:28  Page     4

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                              90 * See all object data and macro generated model statements in the listing
                                              91          PRINT DATA,GEN

                                              93 * Inform the SATK macros of the architecture being targeted.  Inferred from
                                              94 * the ASMA -t command-line argument.
                                              95          ARCHLVL
                                              97+$AL      OPSYN AL
                                              98+$ALR     OPSYN ALR
                                              99+$B       OPSYN B
                                             100+$BC      OPSYN BC
                                             101+$BCTR    OPSYN BCTR
                                             102+$BE      OPSYN BE
                                             103+$BH      OPSYN BH
                                             104+$BL      OPSYN BL
                                             105+$BM      OPSYN BM
                                             106+$BNE     OPSYN BNE
                                             107+$BNH     OPSYN BNH
                                             108+$BNL     OPSYN BNL
                                             109+$BNM     OPSYN BNM
                                             110+$BNO     OPSYN BNO
                                             111+$BNP     OPSYN BNP
                                             112+$BNZ     OPSYN BNZ
                                             113+$BO      OPSYN BO
                                             114+$BP      OPSYN BP
                                             115+$BXLE    OPSYN BXLE
                                             116+$BZ      OPSYN BZ
                                             117+$CH      OPSYN CH
                                             118+$CLR     OPSYN CLR
                                             119+$L       OPSYN L
                                             120+$LH      OPSYN LH
                                             121+$LM      OPSYN LM
                                             122+$LNR     OPSYN LNR
                                             123+$LPSW    OPSYN LPSW
                                             124+$LR      OPSYN LR
                                             125+$LTR     OPSYN LTR
                                             126+$NR      OPSYN NR
                                             127+$SL      OPSYN SL
                                             128+$SLR     OPSYN SLR
                                             129+$SR      OPSYN SR
                                             130+$ST      OPSYN ST
                                             131+$STM     OPSYN STM
                                             132+$X       OPSYN X
                                             133+$BAS     OPSYN BAL
                                             134+$BASR    OPSYN BALR
                                             135+         MNOTE *,'ARCHLVL - ARCHITECTURE LEVEL SET - 1'
        ** [135] MNOTE *,ARCHLVL - ARCHITECTURE LEVEL SET - 1
                                             136 * Ensure interrupt traps are loaded by iplasma.py before program execution
                                             137 * begins.  This macro will create the memory region that will also contain
                                             138 * the IPL PSW.  The region name defaults to ASAREGN.  iplasma.py knows how
                                             139 * to deal with this situation.
                                             140 ASASECT  ASALOAD
                            000000  0001FF   141+ASASECT  START 0,ASAREGN
ASMA Ver. 0.2.1  ECHO - CONSOLE ECHO TEST                                                           07 Nov 2021 10:05:28  Page     5

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

000000  00020000 00000008                    143+         PSW   0,0,2,0,X'008'      64-bit Restart ISR Trap New PSW
000008                      000008  000058   144+         ORG   ASASECT+X'058'
000058  00020000 00000018                    146+         PSW   0,0,2,0,X'018'      64-bit External ISR Trap New PSW
000060  00020000 00000020                    147+         PSW   0,0,2,0,X'020'      64-bit Supervisor Call ISR Trap New PSW
000068  00020000 00000028                    148+         PSW   0,0,2,0,X'028'      64-bit Program ISR Trap New PSW
000070  00020000 00000030                    149+         PSW   0,0,2,0,X'030'      64-bit Machine Check Trap New PSW
000078  00020000 00000038                    150+         PSW   0,0,2,0,X'038'      64-bit Input/Output Trap New PSW
000080                      000080  000200   151+         ORG   ASASECT+512
                                             152          ASAIPL IA=PGMSTART    Define the bare-metal program's IPL PSW
                            000000  0001FF   153+ASASECT  CSECT
000200                      000200  000000   154+         ORG   ASASECT
000000  00000000 00002000                    155+         PSW   0,0,0,0,PGMSTART,24
000008                      000008  000200   156+         ORG   ASASECT+512      Reset CSECT to end of assigned storage area
                            000000  0001FF   157+ASASECT  CSECT
ASMA Ver. 0.2.1  ECHO - POSITION 00 - PROGRAM INITIALIZATION                                        07 Nov 2021 10:05:28  Page     6

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                             159 *
                                             160 * The Bare-Metal Echo Program
                                             161 *

                            002000  0022FF   163 PGMSECT  START X'2000',ECHO  Start a second region for the program itself
                                             164 * This results in ECHO.bin being created in the list directed IPL directory
002000                      000000           165          USING ASA,0           Give me instruction access to the ASA CSECT
002000  05C0                                 166 PGMSTART BALR  R12,0           Establish my base register
002002                      002002           167          USING *,R12           Tell the assembler



                                             169 * Determine if the console device, subchannel and channel are ready for use.
002002  4810 C206                   002208   170          LH    R1,CONDEV   Console device address in I/O inst. register
002006  9D00 1000                   000000   171          TIO   0(R1)       Determine if the console is there
00200A  4710 C288                   00228A   172          BC    B'0001',DEVNOAVL  ..No, CC=3 might have a different config address
00200E  4720 C29A                   00229C   173          BC    B'0010',DEVBUSY   ..No, CC=2 console device or channel is busy
002012  4740 C2DC                   0022DE   174          BC    B'0100',CSWSTRD   ..No, CC=1 CSW stored in ASA at X'40'
                                             175 * Console device is available (CC=0)!
ASMA Ver. 0.2.1  ECHO - POSITION 01 - GET CONSOLE INPUT                                             07 Nov 2021 10:05:28  Page     7

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                             177 * Send operator prompt and accept the operator's input
002016                                       178 ECHOMAIN DS    0H    Query operator and echo data
002016  9201 C20E                   002210   179          MVI   PGMRTN,ECHOGET    Displaying the query...
                                             180 *         MVI   CANATTN,X'00'     Clear cancel/ATTN state
00201A  9200 C234                   002236   181          MVI   DATA,X'00'        Clear the input...
00201E  D24E C235 C234      002237  002236   182          MVC   DATA+1(L'DATA-1),DATA     ...I/O area.
002024  4120 C1D6                   0021D8   183          LA    R2,GETDATA        Locate the initial CCW
002028  45F0 C0C0                   0020C2   184          BAL   R15,DOIO    Request console input
00202C  47F0 C084                   002086   185          B     CNCLHND           ..Accept CANCEL and wait for ATTN
002030  47F0 C014                   002016   186          B     ECHOMAIN          ..Ignore program interrupt
                                             187 *                                ..On success, echo the operator's response

                                             189 * Calculate the length of the operator's input string (may be zero).
002034  4830 C20A                   00220C   190          LH    R3,INLEN          Fetch the lengh of the input area
002038  4B30 0046                   000046   191          SH    R3,CSW+6          Calculate actual bytes read
00203C  4780 C06C                   00206E   192          BZ    ECHOCR            If no data, operator just hit ENTER
002040  4930 C20C                   00220E   193          CH    R3,QUITLEN        Was only four bytes entered?
002044  4770 C050                   002052   194          BNE   CONSECHO          ..No, echo the input

002048                                       196 CKQUIT   DS    0H   Check if quit was entered (only when four bytes entered)e
002048  D503 C230 C234      002232  002236   197          CLC   QUIT,DATA         Did operator enter quit
00204E  4780 C284                   002286   198          BE    FINISH            ..Yes, end the program.
                                             199 *                                ..No, echo the operator's input (fall through)
ASMA Ver. 0.2.1  ECHO - POSITION 02 - ECHO INPUT BACK TO THE CONSOLE                                07 Nov 2021 10:05:28  Page     8

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                             201 *
                                             202 * Echo operator's input data on the console
                                             203 *
002052                                       204 CONSECHO DS    0H   Echo operator's input back to the operator
002052  9202 C20E                   002210   205          MVI   PGMRTN,ECHODATA   Displaying the query response..
002056  4030 C1FC                   0021FE   206          STH   R3,PUTLEN         Update the CCW with the actual output length
00205A  4120 C1F6                   0021F8   207          LA    R2,PUTDATA        Locate the initial CCW
00205E  45F0 C0C0                   0020C2   208          BAL   R15,DOIO          Echo the operator's input
002062  47F0 C014                   002016   209          B     ECHOMAIN          ..Ignore CANCEL from operator during echo
002066  47F0 C014                   002016   210          B     ECHOMAIN          ..Ignore program interrupt FIXME!!)
00206A  47F0 C014                   002016   211          B     ECHOMAIN          On success, return to the main echo loop

00206E                                       213 ECHOCR   DS    0H   Simply echo a carriage return
                                             214 * Note: a different channel program is required to handle the case where the
                                             215 * operator has hit only the ENTER key.  This results in a calculated length
                                             216 * of zero (detected above).  Zero can not be used as the length of a device
                                             217 * directed CCW.  This logic (functionaly identical to the preceding logic in
                                             218 * CONSECHO)transmits one byte of data, a new line (carriage return) character
                                             219 * without the CCW itself adding the carriage return.  This logic has a CCW
                                             220 * lengthfield of one, which IS valid.
00206E  9203 C20E                   002210   221          MVI   PGMRTN,ECHOCRCH   Displaying the query response, just a CR
002072  4120 C1FE                   002200   222          LA    R2,PUTCR          Point to the CCW that outputs just a CR
002076  45F0 C0C0                   0020C2   223          BAL   R15,DOIO          Use subroutine to perform the I/O
00207A  47F0 C014                   002016   224          B     ECHOMAIN          ..Ignore CANCEL from the operator
00207E  47F0 C014                   002016   225          B     ECHOMAIN          ..Ignore program interrupt
002082  47F0 C014                   002016   226          B     ECHOMAIN          On success, return to the main echo loop
ASMA Ver. 0.2.1  ECHO - CANCEL/ATTN HANDLERS                                                        07 Nov 2021 10:05:28  Page     9

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

002086                                       228 CNCLHND  DS    0H   Handle a CANCEL (UNIT EXCEPTION) from the console
002086  9205 C20E                   002210   229          MVI   PGMRTN,CNCLPOS    CANCEL being handled
00208A  9680 C20F                   002211   230          OI    CANATTN,CANHIT    Set existence of the cancel state
00208E  4120 C1EE                   0021F0   231          LA    R2,PUTCNCL        Display that a CANCEL was detected
002092  45F0 C0C0                   0020C2   232          BAL   R15,DOIO          Perform the console display
002096  47F0 C09C                   00209E   233          B     ATTNWAIT          ..Ignore CANCEL from the operator
00209A  47F0 C09C                   00209E   234          B     ATTNWAIT          ..Ignore program interrupt
                                             235 * Wait for an I/O interruption
00209E  45F0 C110                   002112   236 ATTNWAIT BAL   R15,IOWAIT        Wait for an I/O interruption
0020A2  9180 0044                   000044   237          TM    CSW+4,X'80'       Does the interrupt contain an ATTN?
0020A6  47E0 C09C                   00209E   238          BNO   ATTNWAIT          ..No, continue waiting
                                             239 * ATTENTION detected
0020AA  9640 C20F                   002211   240          OI    CANATTN,ATTNHIT   ATTN hit (turning off cancel state)
0020AE  4120 C1E6                   0021E8   241          LA    R2,PUTATTN        Display that an ATTN was detected
0020B2  45F0 C0C0                   0020C2   242          BAL   R15,DOIO          Use subroutine to perform the I/O
0020B6  47F0 C014                   002016   243          B     ECHOMAIN          ..Ignore CANCEL from the operator
0020BA  47F0 C014                   002016   244          B     ECHOMAIN          ..Ignore program interrupt
0020BE  47F0 C014                   002016   245          B     ECHOMAIN          On success, return to the main echo loop
ASMA Ver. 0.2.1  ECHO - INPUT/OUTPUT ROUTINE                                                        07 Nov 2021 10:05:28  Page    10

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                             247 *
                                             248 * CONSOLE INPUT/OUTPUT ROUTINE
                                             249 *
                                             250 * Register Usage:
                                             251 *  R1  - Device address performing the I/O in low-order 16 bits
                                             252 *  R2  - Address of the first CCW of the I/O request, bits 0-7 zeros, 8-31 address
                                             253 *  R11 - Zero (0), used to clear accumulated status field
                                             254 *  R15 - Routine return address:
                                             255 * Return Conventions:
                                             256 *    R15+0   CANCEL signaled by operator
                                             257 *    R15+4   Operator interrupted program (uses external interruption)
                                             258 *    R15+8   Normal termination

0020C2                                       260 DOIO     DS    0H
0020C2  40B0 C208                   00220A   261          STH   R11,STATUS      Clear status for console I/O operation
0020C6  5020 0048                   000048   262          ST    R2,CAW          Tell the I/O request its address in ASA
0020CA  9C00 1000                   000000   263          SIO   0(R1)       Request console channel program to start, did it?
0020CE  4710 C288                   00228A   264          BC    B'0001',DEVNOAVL  ..No, CC=3 don't know why, but tell someone.
0020D2  4720 C29A                   00229C   265          BC    B'0010',DEVBUSY   ..No, CC=2 console device or channel is busy
0020D6  4740 C2DC                   0022DE   266          BC    B'0100',CSWSTRD   ..No, CC=1 CSW stored in ASA at X'40'
                                             267 * Transfer initiated (CC=0)...
0020DA  9D00 1000                   000000   268 POLL     TIO   0(R1)             Test the I/O progress.
0020DE  4720 C0D8                   0020DA   269          BC    B'0010',POLL      CC=2, data still being sent, cont. polling
0020E2  4710 C288                   00228A   270          BC    B'0001',DEVNOAVL  CC=3, don't know why, but tell someone.
0020E6  4780 C2AC                   0022AE   271          BC    B'1000',NOCSW     CC=0, missed CSW, don't know why abort
                                             272 * CSW stored (CC=1), analyze for result.
0020EA  D601 C208 0044      00220A  000044   273          OC    STATUS,CSW+4      Accummulate Device and Channel status
0020F0  9500 C209                   00220B   274          CLI   STATUS+1,X'00'    Did the channel have a problem?
0020F4  4770 C2D2                   0022D4   275          BNE   CSWACCUM          ..Yes, end with a device/channel error
                                             276 * Test for abnormal status for a console device
0020F8  91C2 C208                   00220A   277          TM    STATUS,X'C2'      Was a device error reported?
                                             278 * ATTN, STATUS MODIFIER, and UNIT CHECK are treated as errors.  ATTN is only
                                             279 * possible when no I/O operation (from SIO through DEVICE END) is occurring.
0020FC  4770 C2D2                   0022D4   280          BNZ   CSWACCUM          ..Yes, end with a device/channel error
                                             281 * Channel end, control unit end and busy are ignored.
002100  9104 C208                   00220A   282          TM    STATUS,X'04'      Device finally done?
                                             283 * If DEVICE END not present, the program continues to test for it
002104  47E0 C0D8                   0020DA   284          BNO   POLL              ..No, Check again...

                                             286 * Check for normal conditions and return to caller
002108  9101 C208                   00220A   287          TM    STATUS,X'01'      UNIT EXCEPTION present?
00210C  47E0 F008                   000008   288          BNO   8(,R15)           ..No, return to caller +8 (Normal end)
                                             289 * UNIT EXCEPTION, is treated as normal.  UNIT EXCEPTION is
                                             290 * generated by the operator hitting the CANCEL key.  Not all console
                                             291 * emulations support CANCEL from the operator.
002110  07FF                                 292          BR    R15               ..Yes, return to caller +0 (Handle CANCEL)
ASMA Ver. 0.2.1  ECHO - INTERRUPTION HANDLERS AND WAIT ROUTINES                                     07 Nov 2021 10:05:28  Page    11

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                             294 *
                                             295 * I/O WAIT SUBROUTINE
                                             296 *
                                             297 *  Register usage:
                                             298 *    R1  - Device Channel/Unit address
                                             299 *    R12 - Global program base address
                                             300 *    R15 - Subroutine return address
                                             301 *
                                             302 *  Side Effects:
                                             303 *    External interrupts are disabled following this routine
                                             304 *
                                             305 *  Abnormal Terminations:
                                             306 *    Interrupt from unexpected device received.

002112  D207 0078 C136              002138   308 IOWAIT   MVC   IONPSW(8),CONT  Set up continuation PSW for after I/O interrupt
002118  8200 C12E                   002130   309          LPSW  WAIT       Wait for I/O interruption and CSW from channel
                            00211C  000001   310 IODONE   EQU   *          The bare-metal program continues here after I/O
00211C  D207 0078 C13E              002140   311          MVC   IONPSW(8),IOTRAP     Restore I/O trap PSW
                                             312 *   Did the interruption come from the expected device?
002122  4910 003A                   00003A   313          CH    R1,IOOPSW+2          Is the interrupt from the expected device?
002126  078F                                 314          BER   R15                  ..Yes, return to caller
002128  47F0 C2BE                   0022C0   315          B     DEVUNKN              ..No, end program with an error

002130  F8020000 00000000                    317 WAIT     PSW360 X'F8',0,2,0,0       Causes CPU to wait for I/O interruption
                                             318 *                                   Channels 0-4 enabled for interrupts
002138  00000000 0000211C                    319 CONT     PSW360 0,0,0,0,IODONE      Causes the CPU to continue after waiting
002140  00020000 00000038                    320 IOTRAP   PSW360 0,0,2,0,X'38'       I/O trap New PSW (restored after I/O)



                                             322 *
                                             323 * DISABLE EXTERNAL INTERRUPTS
                                             324 *
                                             325 *  Register usage:
                                             326 *    R12 - Global program base address
                                             327 *    R15 - Routine return address
                                             328 *
                                             329 * Side Effects:
                                             330 *    Input/output interruptions disabled for all channels

002148                                       332 EXTDIS   DS    0H
002148  8200 C15E                   002160   333          LPSW  EXTDPSW              Disable external interruptions
                                             334 * Execution continues with the following instruction
00214C  D207 0058 C156      000058  002158   335 EXTDISC  MVC   EXTNPSW,EXTTRAP      Trap any unexpected external interruptions
002152  07FF                                 336          BR    R15                  Return to caller

002158  00000000 00000058                    338 EXTTRAP  PSW360 0,0,0,0,X'58'       External interruption trap PSW
                                             339 * Disable external interruptions and continue with the routine
002160  00000000 0000214C                    340 EXTDPSW  PSW360 0,0,0,0,EXTDISC
ASMA Ver. 0.2.1  ECHO - INTERRUPTION HANDLERS AND WAIT ROUTINES                                     07 Nov 2021 10:05:28  Page    12

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                             342 *
                                             343 * ENABLE EXTERNAL INTERRUPTS
                                             344 *
                                             345 *  Register usage:
                                             346 *    R12 - Global program base address
                                             347 *    R15 - Routine return address
                                             348 *
                                             349 * Side Effects:
                                             350 *    Input/output interruptions disabled for all channels

002168                                       352 EXTENA   DS    0H
002168  D207 0058 C176      000058  002178   353          MVC   EXTNPSW,EXTHPSW     Set external interrupt handler
                                             354 * Actual external interruptions are not yet enabled.
                                             355 * Return to caller and simulataneously set external interruptions
00216E  50F0 C182                   002184   356          ST    R15,EXTCPSW+4    Return to caller when the PSW is loaded
002172  8200 C17E                   002180   357          LPSW  EXTCPSW      This instruction enables external interruptions
                                             358 * Theoretically an external interruption may occur following this
                                             359 * instruction, but control has already been returned to the caller.

                                             361 * Pass control to interrupt handler when an external interrupt occurs, but
                                             362 * disable any more external interruptions while in the handler.
002178  00000000 00002188                    363 EXTHPSW  PSW360 X'00',0,0,0,EXTHDL
                                             364 * Enables actual external interruptions while returning to the caller.
002180  01000000 00000000                    365 EXTCPSW  PSW360 X'01',0,0,0,0



                                             367 *
                                             368 * EXTERNAL INTERRUPT HANDLER
                                             369 *
                                             370 *  Register usage:
                                             371 *    R12 - Global program base address
                                             372 *
                                             373 *  Two bytes of external interruption information is stored within the
                                             374 *  exernal old PSW at address X'1A'.  The old PSW format is:
                                             375 *
                                             376 *   18       19       1A       1B       1C       1D       1E       1F
                                             377 *   +0       +8       +16      +24      +32      +40      +48      +56
                                             378 *  +--------+--------+--------+--------+--------+--------+--------+--------+
                                             379 *  |........|........|00000000|TKS00000|........|........|........|........|
                                             380 *  +--------+--------+--------+--------+--------+--------+--------+--------+
                                             381 *
                                             382 *  Where:
                                             383 *     T == a timer interruption (X'80')
                                             384 *     K == the interrupt key has been hit (X'40')
                                             385 *     S == an external signal has occurred (X'20')
                                             386 *
                                             387 * This handler ignores timer and external signals.  Only the interrupt key
                                             388 * is recognized.  When an external interruption is ignored, control returns
                                             389 * to the point of the interruption.
                                             390 *
                                             391 * When an interrupt key is detected, any current I/O operation is halted and
ASMA Ver. 0.2.1  ECHO - INTERRUPTION HANDLERS AND WAIT ROUTINES                                     07 Nov 2021 10:05:28  Page    13

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                             392 * the interrupt key is treated as a cancel, namely waiting for ATTN being
                                             393 * recognized.

002188                                       395 EXTHDL   DS    0H
                                             396 * Trap an external interrupt while this routine is running.  Should not
                                             397 * occur but that is why the trap is set
002188  D207 0058 C156      000058  002158   398          MVC   EXTNPSW,EXTTRAP     Disable external interruption within handler
00218E  9140 001B                   00001B   399          TM    EXTOPSW+3,X'40'     Is this an interrupt key interruption?
002192  4710 C198                   00219A   400          BO    EXTKEY              ..Yes, handle the interrupt key
002196  8200 0018                   000018   401          LPSW  EXTOPSW             ..No, just return to interrupted logic

00219A                                       403 EXTKEY   DS    0H   Treat the interrupt key like a cancel
00219A  9206 C20E                   002210   404          MVI   PGMRTN,EXTPOS       Handling an external interrupt
                                             405 * HALT any I/O operation being executed
00219E  9E00 1000                   000000   406          HIO   0(R1)               Halt the I/O..
0021A2  4710 C288                   00228A   407          BC    B'0001',DEVNOAVL    CC=3, Device not available, abend
                                             408 *         BC    B'1000',AVAILWAT   CC=0, Interruption pending in subchannel
                                             409 *         BC    B'0100',AVAILWAT   CC=1, CSW stored, wait for availability
                                             410 *         BC    B'0010',AVAILWAT   CC=2, Burst ended on selector channel

                                             412 * Wait for the device to become available
0021A6  40B0 C208                   00220A   413          STH   R11,STATUS        Clear status for console availability
0021AA  9D00 1000                   000000   414 AVAILTST TIO   0(R1)             Test the device path
0021AE  4720 C1A8                   0021AA   415          BC    B'0010',AVAILTST  CC=2, device still busy, cont. checking
0021B2  4740 C1BC                   0021BE   416          BC    B'0100',EXTCSW    CC=1, CSW stored check it...
0021B6  4780 C1D2                   0021D4   417          BC    B'1000',EXTAVAIL  CC=0, device is available, continue
0021BA  4710 C288                   00228A   418          BC    B'0001',DEVNOAVL  CC=3, don't know why, but tell someone.

0021BE                                       420 EXTCSW   DS    0H  CSW stored, see if the device and channel are available
0021BE  D601 C208 0044      00220A  000044   421          OC    STATUS,CSW+4      Accummulate Device and Channel status
0021C4  9500 C209                   00220B   422          CLI   STATUS+1,X'00'    Did the channel have a problem?
0021C8  4770 C2D2                   0022D4   423          BNE   CSWACCUM          ..Yes, end with a device/channel error
0021CC  910C C208                   00220A   424          TM    STATUS,X'0C'      Channel end and device end?
0021D0  47E0 C1A8                   0021AA   425          BNO   AVAILTST          ..No, wait for them to become available

0021D4                                       427 EXTAVAIL DS    0H   Console device now available
                                             428
                                             429
                                             430
                                             431
                                             432
ASMA Ver. 0.2.1  ECHO - DATA AREAS                                                                  07 Nov 2021 10:05:28  Page    14

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                             434 *
                                             435 * Channel Command Words
                                             436 *

                                             438 * Doubleword aligned data
0021D8  0100222B 40000007                    439 GETDATA  CCW   X'01',ENTER,X'40',L'ENTER   Display 'ENTER: ' on console
                                             440 *              Command-chain (X'40') to the next CCW
0021E0  0A002236 20000050                    441          CCW   X'0A',DATA,X'20',L'DATA     Read operator's data
                                             442 *              Suppress Incorrect Length Indicator - operator's data varies

0021E8  09002212 0000000B                    444 PUTATTN  CCW   X'09',ATTNSTR,0,ATTNSTRL    Display ATTN string

0021F0  0900221D 0000000D                    446 PUTCNCL  CCW   X'09',CNCLSTR,0,CNCLSTRL    Display the CANCEL string

0021F8  09002236 00000000                    448 PUTDATA  CCW   X'09',DATA,0,0              Echo operator's data
002200                      002200  0001FE   449          ORG   PUTDATA+6
0021FE  0000                                 450 PUTLEN   DS    HL2                         Echo'd data's length

002200  0100222A 00000001                    452 PUTCR    CCW   X'01',CRDATA,X'00',L'CRDATA   Echo just a CR

                                             454 *
                                             455 * I/O related information
                                             456 *
                                             457 * Half-word aligned data
002208                                       458          DS    0H          Align half words
002208  001F                                 459 CONDEV   DC    XL2'001F'   Console device address
00220A  0000                                 460 STATUS   DC    XL2'0000'   Used to accumulate unit and channel status

00220C  0050                                 462 INLEN    DC    Y(L'DATA)   Input data length (Could also use prev. CCW)
00220E  0004                                 463 QUITLEN  DC    Y(L'QUIT)   Length of quit literal



                                             465 * Unaligned data

                                             467 * Program position used in building abend address
                            000000  000001   468 INIT     EQU   X'00'        Program initialization
                            000001  000001   469 ECHOGET  EQU   X'01'        Operator prompt and input retrieved
                            000002  000001   470 ECHODATA EQU   X'02'        Echoing data from the operator
                            000003  000001   471 ECHOCRCH EQU   X'03'        Echo just a new line character (carriage return)
                            000004  000001   472 ATTNPOS  EQU   X'04'        ATTN handler
                            000005  000001   473 CNCLPOS  EQU   X'05'        CANCEL handler
                            000006  000001   474 EXTPOS   EQU   X'06'        Interruption key being handled
002210  00                                   475 PGMRTN   DC    AL1(INIT)    Initialize program position data

                                             477 * CANCEL/ATTN status
002211  00                                   478 CANATTN  DC    XL1'00'
                            000080  000001   479 CANHIT   EQU   X'80'         A cancel key was detected (control-c)
                            000040  000001   480 ATTNHIT  EQU   X'40'         An ATTN key was detected (esc)

                                             482 * ECHO program data areas
002212  155C5C40 C1E3E3D5                    483 ATTNSTR  DC    XL1'15',C'** ATTN **'
ASMA Ver. 0.2.1  ECHO - DATA AREAS                                                                  07 Nov 2021 10:05:28  Page    15

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

00221A  405C5C
                            00000B  000001   484 ATTNSTRL EQU   *-ATTNSTR
00221D  155C5C40 C3C1D5C3                    485 CNCLSTR  DC    XL1'15',C'** CANCEL **'
002225  C5D3405C 5C
                            00000D  000001   486 CNCLSTRL EQU   *-CNCLSTR
00222A  15                                   487 CRDATA   DC    XL1'15'      Just a new line (carriage return) character
00222B  C5D5E3C5 D97A40                      488 ENTER    DC    C'ENTER: '   Operator prompt
002232  98A489A3                             489 QUIT     DC    C'quit'      quit (terminates the program)
                                             490 **** Debug harness
                                             491 *         DS    D       Uncomment this statement to separate constants
                                             492 **** Debug harness
002236  00000000 00000000                    493 DATA     DC    XL80'00'
00223E  00000000 00000000
002246  00000000 00000000
00224E  00000000 00000000
002256  00000000 00000000
00225E  00000000 00000000
002266  00000000 00000000
00226E  00000000 00000000
002276  00000000 00000000
00227E  00000000 00000000
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    16

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                             495 *
                                             496 * NORMAL PROGARM TERMINATION
                                             497 *
                                             498 * Register usage:
                                             499 *   R12 - Global program base address
                                             500 * Normal Termination:
                                             501 *   Termination code X'000000'

002286  8200 C2F6                   0022F8   503 FINISH   LPSW  DONE     Normally Terminate the program



                                             505 *
                                             506 * REPORT DEVICE NOT OPERATIONAL - Uses Format 1 ABEND
                                             507 *
                                             508 * Register usage:
                                             509 *   R1  - Device Channel/Unit address
                                             510 *   R12 - Global program base address
                                             511 * Abnormal Termination:
                                             512 *    Format 1 ABEND code X'1x'

00228A                                       514 DEVNOAVL DS    0H
00228A  4010 C2FC                   0022FE   515          STH   1,FMT1CUU         Set the failing device address
00228E  9210 C2FB                   0022FD   516          MVI   FMT1CODE,X'10'    Set the abend code
002292  D600 C2FB C20E      0022FD  002210   517          OC    FMT1CODE,PGMRTN   Set where the abend was detected
002298  8200 C2F6                   0022F8   518          LPSW  DONE              End execution abnormally



                                             520 *
                                             521 * REPORT DEVICE BUSY - Uses Format 1 ABEND
                                             522 *
                                             523 * Register usage:
                                             524 *   R1  - Device Channel/Unit address
                                             525 *   R12 - Global program base address
                                             526 * Abnormal Termination:
                                             527 *    Format 1 ABEND code X'2x

00229C                                       529 DEVBUSY  DS    0H
00229C  4010 C2FC                   0022FE   530          STH   1,FMT1CUU         Set the failing device address
0022A0  9220 C2FB                   0022FD   531          MVI   FMT1CODE,X'20'    Set the abend code
0022A4  D600 C2FB C20E      0022FD  002210   532          OC    FMT1CODE,PGMRTN   Set where the abend was detected
0022AA  8200 C2F6                   0022F8   533          LPSW  DONE              End execution abnormally

                                             535 *
                                             536 * REPORT STORING OF CSW MISSING - Uses Format 1 ABEND
                                             537 *
                                             538 * Register usage:
                                             539 *   R1  - Device Channel/Unit address
                                             540 *   R12 - Global program base address
                                             541 * Abnormal Termination:
                                             542 *    Format 1 ABEND code X'3x
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    17

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT


0022AE                                       544 NOCSW    DS    0H
0022AE  4010 C2FC                   0022FE   545          STH   1,FMT1CUU         Set the failing device address
0022B2  9230 C2FB                   0022FD   546          MVI   FMT1CODE,X'30'    Set the abend code
0022B6  D600 C2FB C20E      0022FD  002210   547          OC    FMT1CODE,PGMRTN   Set where the abend was detected
0022BC  8200 C2F6                   0022F8   548          LPSW  DONE              End execution abnormally



                                             550 *
                                             551 * REPORT UNEXPECTED DEVICE RESPONSE - Uses Format 1 ABEND PSW
                                             552 *
                                             553 * Register usage:
                                             554 *   R1  - Device Channel/Unit address
                                             555 *   R12 - Global program base address
                                             556 * Abnormal Termination:
                                             557 *    Format 1 ABEND code X'4x'

0022C0                                       559 DEVUNKN  DS    0H
0022C0  D201 C2FC 003A      0022FE  00003A   560          MVC   FMT1CUU,IOOPSW+2 Set the unexpected device address
0022C6  9240 C2FB                   0022FD   561          MVI   FMT1CODE,X'40'   Set the abend code
0022CA  D600 C2FB C20E      0022FD  002210   562          OC    FMT1CODE,PGMRTN  Set where the abend was detected
0022D0  8200 C2F6                   0022F8   563          LPSW  DONE             End execution abnormally



                                             565 *
                                             566 * REPORT CONSOLE DEVICE OR CHANNEL ERROR STATUS - Uses Format 2 ABEND PSW
                                             567 *
                                             568 * Register usage:
                                             569 *   R1  - Device Channel/Unit address
                                             570 *   R12 - Global program base address
                                             571 * Abnormal Termination:
                                             572 *    Format 2 ABEND code X'5x'

0022D4                                       574 CSWACCUM DS    0H    Store the accumulated status in the abort PSW
0022D4  D201 C2FC C208      0022FE  00220A   575          MVC   FMT2STAT,STATUS   Move accumulated status to abort PSW
0022DA  47F0 C2E2                   0022E4   576          B     CODE50            Set up format 2 abend code
0022DE                                       577 CSWSTRD  DS    0H
0022DE  D201 C2FC 0044      0022FE  000044   578          MVC   FMT2STAT,CSW+4    Move stored CSW status to the abort PSW

0022E4                                       580 CODE50   DS    0H
0022E4  9250 C2FB                   0022FD   581          MVI   FMT2CODE,X'50'    Set the abend code
0022E8  D600 C2FB C20E      0022FD  002210   582          OC    FMT2CODE,PGMRTN   Set where the abend was detected
0022EE  8200 C2F6                   0022F8   583          LPSW  DONE              End execution abnormally



                                             585 *
                                             586 * REPORT CONSOLE DEVICE SENSE - Uses Format 3 ABEND PSW
                                             587 *
                                             588 * Register usage:
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    18

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

                                             589 *   R1  - Device Channel/Unit address
                                             590 *   R12 - Global program base address
                                             591 * Abnormal Termination:
                                             592 *    Format 3 ABEND code X'6x'
                                             593 *
                                             594 *ABENDSNS DS    0H
                                             595 *         MVC   FMT3SNS,SENSDATA   Move the generic sense byte abend PSW
                                             596 *         MVI   FMT3CODE,X'60'     Set the abend code
                                             597 *         LPSW  DONE



                                             599 *
                                             600 * TERMINATION PSW Formats
                                             601 *
0022F8  00020000 00000000                    602 DONE     PSW360 0,0,2,0,0
002300                      002300  0002FD   603          ORG   *-3
0022FD                                       604 FORMAT   DS    0AL3
                                             605 * Format 1 ABEND FORMAT
0022FD  00                                   606 FMT1CODE DS    X'00'   aa - Abend codes: 1x, 2x, 3x, 4x - x=program position
0022FE  0000                                 607 FMT1CUU  DS    H'0'    ccuu - address of device causing the termination
002300                      002300  0002FD   608          ORG  FORMAT
                                             609 * Format 2 ABEND FORMAT
0022FD  00                                   610 FMT2CODE DS    X'00'   aa - Abend Code: 5x -          x=program position
0022FE  0000                                 611 FMT2STAT DS    H'00'   ddcc - dd=console device status, cc=channel status
002300                      002300  0002FD   612          ORG  FORMAT
                                             613 * Format 3 ABEND FORMAT
0022FD  00                                   614 FMT3CODE DS    X'00'   aa - Abend Code: 50
0022FE  00                                   615          DS    X'00'   not used: X'00'
0022FF  00                                   616 FMT3SNS  DS    X'00'   ss - console device generic sense data



                                             618 *
                                             619 * Hardware Assigned Storage Locations
                                             620 *

                                             622 * This DSECT allows symbolic access to these locations.  The DSECT created is
                                             623 * named ASA.
                                             624 ASA      ASAREA DSECT=YES
                                             625+ASA      DSECT
                            000000  000001   626+ASBEGIN  EQU   *                   Start of absolute/real assigned storage areas
000000  00000000 00000000                    627+IPLPSW   DC    FD'0'        000 A  Initial Program Load Program Status Word
000008  00000000 00000000                    628+IPLCCW1  DC    FD'0'        008 A  Initial Program Load first Channel Command Word
000010  00000000 00000000                    629+IPLCCW2  DC    FD'0'        010 A  Initial program Load second Channel Command Word
                                             630+* RESTART RELATED PROGRAM STATUS WORDS
000018                      000018  000000   631+         ORG   ASBEGIN
000000  00000000 00000000                    632+RSTNPSW  DC    FD'0'        000 R  Restart New PSW
000008  00000000 00000000                    633+RSTOPSW  DC    FD'0'        008 R  Restart Old PSW
000010  00000000 00000000                    634+UA0      DC    FD'0'        010 R  Unassigned Area 0
                                             635+* INTERRUPTION OLD PROGRAM STATUS WORD SAVE AREAS
000018  00000000 00000000                    636+EXTOPSW  DC    FD'0'        018 R  External Interrupt Old PSW
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    19

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

000020  00000000 00000000                    637+SVCOPSW  DC    FD'0'        020 R  Supervisor Call Old PSW
000028  00000000 00000000                    638+PGMOPSW  DC    FD'0'        028 R  Program Old PSW
000030  00000000 00000000                    639+MCKOPSW  DC    FD'0'        030 R  Machine Check Old PSW
000038  00000000 00000000                    640+IOOPSW   DC    FD'0'        038 R  Input/Output Old PSW
                                             641+* System/360 or System/370 Basic Control Mode INTERRUPTION INFORMATION
000040                      000040  00001A   642+         ORG   EXTOPSW+2
00001A  0000                                 643+BCEXTCOD DC    H'0'         01A R  External Interuption Code
00001C                      00001C  000022   644+         ORG   SVCOPSW+2
000022  0000                                 645+BCSVCCOD DC    H'00'        022 R  Supervisor Call Interruption Code
000024                      000024  00002A   646+         ORG   PGMOPSW+2
00002A  0000                                 647+BCPGMCOD DC    H'0'         02A R  Program Interruption Code
00002C                      00002C  000032   648+         ORG   MCKOPSW+2
000032  0000                                 649+BCMCKCOD DC    H'0'         032 R  Machine Check Interruption Code
000034                      000034  00003A   650+         ORG   IOOPSW+2
00003A  0000                                 651+BCIOCOD  DC    H'0'         03A R  Input/Output Interruption Code (Device CCUU)
00003C                      00003C  000040   652+         ORG   *+4
                                             653+* CHANNEL-BASED INPUT/OUTPUT INTERRUPT RELATED
000040  00000000 00000000                    654+CSW      DC    FD'0'        040 R  Channel Status Word
000048                                       655+CAW      DC    0F'0'        048 R  Channel Address Word
000048  00                                   656+CAWKEY   DC    X'00'        048 R  Channel Storage Key (bits 0-3)
                            000008  000001   657+CAWSUSP  EQU   X'08'        048 R  Suspend Control (bit 4)
000049  000000                               658+CAWADDR  DC    AL3(0)       049 R  Channel Command Address
00004C  00000000                             659+UA1      DC    F'0'         04C R  Unassigend Area 1
                                             660+* MISCELANEOUS AREAS
000050  00000000                             661+TIMER    DC    F'0'         050 R  System/360 and System/370 Interval Timer
000054  00000000                             662+TTDES    DC    F'0'         054 R  System/370 Trace-Table-Designation
                                             663+* INTERRUPTION NEW PROGRAM STATUS WORD AREAS
000058                      000058  000058   664+         ORG   ASBEGIN+X'58'
000058  00000000 00000000                    665+EXTNPSW  DC    FD'0'        058 R  External New PSW
000060  00000000 00000000                    666+SVCNPSW  DC    FD'0'        060 R  Supervisor Call New PSW
000068  00000000 00000000                    667+PGMNPSW  DC    FD'0'        068 R  Program New PSW
000070  00000000 00000000                    668+MCKNPSW  DC    FD'0'        070 R  Machine Check New PSW
000078  00000000 00000000                    669+IONPSW   DC    FD'0'        078 R  Input/Output New PSW
                                             670+* System/360 Diagnostic Scanout Area
000080                                       671+SCANOUT  DS    0X           080 A  System/360 Diagnostic Scanout Area
                            000000  000001   672+SCANOUTL EQU   *-SCANOUT           System/360 Diagnostic Scanout Area Length
                                             673+* EXTERNAL INTERRUPTION INFORMATION
000080                      000080  000080   674+         ORG   ASBEGIN+X'80'
000080  00000000                             675+EXTIPARM DC    F'0'         080 R  External-interruption Parameter
000084  0000                                 676+EXTCPUAD DC    H'0'         084 R  External-interruption CPU Address
000086  0000                                 677+EXTICODE DC    H'0'         086 R  External-interruption Code
                                             678+* SUPERVISOR CALL INTERRUPTION INFORMATION
000088                                       679+SVCIID   DC    0F'0'        088 R  Supervisor-Call Interuption Identification
000088  00                                   680+         DC    X'00'        088 R  not-used - zeros stored
000089  00                                   681+SVCIILC  DC    X'00'        089 R  Supervisor-Call instruction length code
                            00000C  000001   682+SVCIILCM EQU   B'00001100'         Supervisor-Call ILC mask, zeros stored in other bits
00008A  0000                                 683+SVCICODE DC    H'0'         08A R  Supervisor-Call Interruption Code
                                             684+* PROGRAM INTERRUPTION INFORMATION
00008C                                       685+PGMIID   DC    0F'0'        08C R  Program-interruption identification
00008C  00                                   686+         DC    X'00'        08C R  not-used - zeros stored
00008D  00                                   687+PGMIILC  DC    X'00'        08D R  Program instruction lengh code
                            00000C  000001   688+PGMIILCM EQU   B'00001100'         Progrtam ILC mask, zeros stored in other bits
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    20

 LOC       OBJECT CODE      ADDR1   ADDR2   STMT

00008E  0000                                 689+PGMICODE DC    H'0'         08E R  Program Interruption Code
000090                                       690+PGMDXC   DC    0F'0'        090 R  Data-Exception Code
000090  00000000                             691+PGMTRX   DC    F'0'         090 R  Translation-Exception Identification
000094                                       692+MONCLS   DC    0H'0'        094 R  Monitor-Class Number
000094  00                                   693+         DC    X'00'        094 R  not-used - zeros stored
000095  00                                   694+MONNUMBR DC    X'00'        095 R  Monitor-Class Number stored
000096  00                                   695+PERCODE  DC    X'00'        096 R  Program-Event-Recording Code
                            0000F0  000001   696+PERCODMK EQU   B'11110000'         Program-Event-Recordind Code mask in bits 0-3
000097  00                                   697+         DC    X'00'        097 R  PER Code not used - zeros stored
000098  00000000                             698+PERADDR  DC    F'0'         098 R  PER Address
00009C  00000000                             699+MONCODE  DC    F'0'         09C R  Monitor Event Code in bytes 1-3, zeros in byte 0
0000A0  00                                   700+PGMACCID DC    X'00'        0A0 R  Exception access identification
0000A1  00                                   701+PERACCID DC    X'00'        0A1 R  PER access identification
0000A2  00                                   702+MPGACCID DC    X'00'        0A2 R  MOVE PAGE Operand access identification
0000A3                                       703+SSARCHMD DC    0X'00'       0A3 A  Store Status Architectural Mode Identification
0000A3  00                                   704+MKARCHMD DC    X'00'        0A3 R  Machine-Check Architectural Mode Identification
0000A4  00000000                             705+UA2      DC    F'0'         0A4 R  Unused area
                                             706+* System/370 CHANNEL INPUT/OUTPUT INFORMATION
0000A8                      0000A8  0000A8   707+         ORG   ASBEGIN+X'A8'
0000A8  00000000                             708+CHANID   DC    F'0'         0A8 R  System/370 STORE CHANNEL ID location
0000AC  00000000                             709+IOELADDR DC    F'0'         0AC R  System/370 I/O Extended Logout Address
0000B0  00000000                             710+LCHANLOG DC    F'0'         0B0 R  System/370 Limited Channel Logout Area
0000B4  00000000                             711+UA3      DC    F'0'         0B4 R  unused by System/370
0000B8  00                                   712+UA4      DC    X'00'        0B8 R  unused by System/370
0000B9  00                                   713+MEASUREB DC    X'00'        0B9 R  System/370 Measurement Byte
0000BA  0000                                 714+IOICODE  DC    H'0'         0BA R  System/370 Input/Output Interruption Device Address
                                             715+* MACHINE-CHECK INTERRUPTION INFORMATION
0000BC                      0000BC  0000D4   716+         ORG   ASBEGIN+X'D4'
0000D4  00000000                             717+MKXSAA   DC    F'0'         0D4 R  Machine-Check Extended Save Area Address
0000D8  00000000 00000000                    718+MKCPUTIM DC    FD'0'        0D8 R  Machine-Check CPU timer save area
0000E0  00000000 00000000                    719+MKCLKCMP DC    FD'0'        0E0 R  Machine-Check clock comparator save area
0000E8  00000000                             720+MKICODE  DC    F'0'         0E8 R  Machine-Check interruption code
0000EC  00000000 00000000                    721+UA6      DC    XL8'00'      0EC R  unused area
0000F4  00000000                             722+MKDMGCOD DC    F'0'         0F4 R  Machine-Check external damage code
0000F8                                       723+ZMKFAILA DC    0FD'0'       0F8 R  Machine-Check failing storage address
0000F8  00000000                             724+MKFAILA  DC    F'0'         0F8 R  Machine-Check failing storage address
0000FC  00000000                             725+MKMODEL  DC    F'0'         0FC R  Machine-Check model dependent information
000100  00000000 00000000                    726+MKLOGOUT DC    4F'0'        100 R  ESA machine-check fixed logout area
000108  00000000 00000000
000110                      000110  000120   727+         ORG   ASBEGIN+X'120'
000120  00000000 00000000                    728+MKARS    DC    16F'0'       120 R  Machine-Check access register save area
000128  00000000 00000000
000130  00000000 00000000
000138  00000000 00000000
000140  00000000 00000000
000148  00000000 00000000
000150  00000000 00000000
000158  00000000 00000000
                            000160  000001   729+ASEND    EQU   *                   End of absolute/real assigned storage areas
                            000160  000001   730+ASLENGTH EQU   ASEND-ASBEGIN       Length of absolute/real assigned storage area
                                             731          END
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    21

     SYMBOL        TYPE  VALUE   LENGTH  DEFN  REFERENCES

ASA                 4    000000     352   625  165
ASAREGN             2    000000     512   141
ASASECT             J    000000     512   141  144  151  154  156
ASBEGIN             U    000000       1   626  631  664  674  707  716  727  730
ASEND               U    000160       1   729  730
ASLENGTH            U    000160       1   730
ATTNHIT             U    000040       1   480  240
ATTNPOS             U    000004       1   472
ATTNSTR             X    002212       1   483  484  444
ATTNSTRL            U    00000B       1   484  444
ATTNWAIT            I    00209E       4   236  233  234  238
AVAILTST            I    0021AA       4   414  415  425
BCEXTCOD            H    00001A       2   643
BCIOCOD             H    00003A       2   651
BCMCKCOD            H    000032       2   649
BCPGMCOD            H    00002A       2   647
BCSVCCOD            H    000022       2   645
CANATTN             X    002211       1   478  230  240
CANHIT              U    000080       1   479  230
CAW                 F    000048       4   655  262
CAWADDR             R    000049       3   658
CAWKEY              X    000048       1   656
CAWSUSP             U    000008       1   657
CHANID              F    0000A8       4   708
CKQUIT              H    002048       2   196
CNCLHND             H    002086       2   228  185
CNCLPOS             U    000005       1   473  229
CNCLSTR             X    00221D       1   485  486  446
CNCLSTRL            U    00000D       1   486  446
CODE50              H    0022E4       2   580  576
CONDEV              X    002208       2   459  170
CONSECHO            H    002052       2   204  194
CONT                3    002138       8   319  308
CRDATA              X    00222A       1   487  452
CSW                 F    000040       8   654  191  237  273  421  578
CSWACCUM            H    0022D4       2   574  275  280  423
CSWSTRD             H    0022DE       2   577  174  266
DATA                X    002236      80   493  181  182  197  441  448  462
DEVBUSY             H    00229C       2   529  173  265
DEVNOAVL            H    00228A       2   514  172  264  270  407  418
DEVUNKN             H    0022C0       2   559  315
DOIO                H    0020C2       2   260  184  208  223  232  242
DONE                3    0022F8       8   602  503  518  533  548  563  583
ECHO                2    002000     768   163
ECHOCR              H    00206E       2   213  192
ECHOCRCH            U    000003       1   471  221
ECHODATA            U    000002       1   470  205
ECHOGET             U    000001       1   469  179
ECHOMAIN            H    002016       2   178  186  209  210  211  224  225  226  243  244  245
ENTER               C    00222B       7   488  439
EXTAVAIL            H    0021D4       2   427  417
EXTCPSW             3    002180       8   365  356  357
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    22

     SYMBOL        TYPE  VALUE   LENGTH  DEFN  REFERENCES

EXTCPUAD            H    000084       2   676
EXTCSW              H    0021BE       2   420  416
EXTDIS              H    002148       2   332
EXTDISC             I    00214C       6   335  340
EXTDPSW             3    002160       8   340  333
EXTENA              H    002168       2   352
EXTHDL              H    002188       2   395  363
EXTHPSW             3    002178       8   363  353
EXTICODE            H    000086       2   677
EXTIPARM            F    000080       4   675
EXTKEY              H    00219A       2   403  400
EXTNPSW             F    000058       8   665  335  353  398
EXTOPSW             F    000018       8   636  642  399  401
EXTPOS              U    000006       1   474  404
EXTTRAP             3    002158       8   338  335  398
FINISH              I    002286       4   503  198
FMT1CODE            X    0022FD       1   606  516  517  531  532  546  547  561  562
FMT1CUU             H    0022FE       2   607  515  530  545  560
FMT2CODE            X    0022FD       1   610  581  582
FMT2STAT            H    0022FE       2   611  575  578
FMT3CODE            X    0022FD       1   614
FMT3SNS             X    0022FF       1   616
FORMAT              R    0022FD       3   604  608  612
GETDATA             W    0021D8       8   439  183
IMAGE               1    000000    1280     0
INIT                U    000000       1   468  475
INLEN               Y    00220C       2   462  190
IODONE              U    00211C       1   310  319
IOELADDR            F    0000AC       4   709
IOICODE             H    0000BA       2   714
IONPSW              F    000078       8   669  308  311
IOOPSW              F    000038       8   640  650  313  560
IOTRAP              3    002140       8   320  311
IOWAIT              I    002112       6   308  236
IPLCCW1             F    000008       8   628
IPLCCW2             F    000010       8   629
IPLPSW              F    000000       8   627
LCHANLOG            F    0000B0       4   710
MCKNPSW             F    000070       8   668
MCKOPSW             F    000030       8   639  648
MEASUREB            X    0000B9       1   713
MKARCHMD            X    0000A3       1   704
MKARS               F    000120       4   728
MKCLKCMP            F    0000E0       8   719
MKCPUTIM            F    0000D8       8   718
MKDMGCOD            F    0000F4       4   722
MKFAILA             F    0000F8       4   724
MKICODE             F    0000E8       4   720
MKLOGOUT            F    000100       4   726
MKMODEL             F    0000FC       4   725
MKXSAA              F    0000D4       4   717
MONCLS              H    000094       2   692
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    23

     SYMBOL        TYPE  VALUE   LENGTH  DEFN  REFERENCES

MONCODE             F    00009C       4   699
MONNUMBR            X    000095       1   694
MPGACCID            X    0000A2       1   702
NOCSW               H    0022AE       2   544  271
PERACCID            X    0000A1       1   701
PERADDR             F    000098       4   698
PERCODE             X    000096       1   695
PERCODMK            U    0000F0       1   696
PGMACCID            X    0000A0       1   700
PGMDXC              F    000090       4   690
PGMICODE            H    00008E       2   689
PGMIID              F    00008C       4   685
PGMIILC             X    00008D       1   687
PGMIILCM            U    00000C       1   688
PGMNPSW             F    000068       8   667
PGMOPSW             F    000028       8   638  646
PGMRTN              R    002210       1   475  179  205  221  229  404  517  532  547  562  582
PGMSECT             J    002000     768   163
PGMSTART            I    002000       2   166  155
PGMTRX              F    000090       4   691
POLL                I    0020DA       4   268  269  284
PUTATTN             W    0021E8       8   444  241
PUTCNCL             W    0021F0       8   446  231
PUTCR               W    002200       8   452  222
PUTDATA             W    0021F8       8   448  449  207
PUTLEN              U    0021FE       2   450  206
QUIT                C    002232       4   489  197  463
QUITLEN             Y    00220E       2   463  193
R0                  U    000000       1    49
R1                  U    000001       1    51  170  171  263  268  313  406  414
R10                 U    00000A       1    60
R11                 U    00000B       1    61  261  413
R12                 U    00000C       1    62  166  167
R13                 U    00000D       1    63
R14                 U    00000E       1    64
R15                 U    00000F       1    65  184  208  223  232  236  242  288  292  314  336  356
R2                  U    000002       1    52  183  207  222  231  241  262
R3                  U    000003       1    53  190  191  193  206
R4                  U    000004       1    54
R5                  U    000005       1    55
R6                  U    000006       1    56
R7                  U    000007       1    57
R8                  U    000008       1    58
R9                  U    000009       1    59
RSTNPSW             F    000000       8   632
RSTOPSW             F    000008       8   633
SCANOUT             X    000080       1   671  672
SCANOUTL            U    000000       1   672
SSARCHMD            X    0000A3       1   703
STATUS              X    00220A       2   460  261  273  274  277  282  287  413  421  422  424  575
SVCICODE            H    00008A       2   683
SVCIID              F    000088       4   679
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    24

     SYMBOL        TYPE  VALUE   LENGTH  DEFN  REFERENCES

SVCIILC             X    000089       1   681
SVCIILCM            U    00000C       1   682
SVCNPSW             F    000060       8   666
SVCOPSW             F    000020       8   637  644
TIMER               F    000050       4   661
TTDES               F    000054       4   662
UA0                 F    000010       8   634
UA1                 F    00004C       4   659
UA2                 F    0000A4       4   705
UA3                 F    0000B4       4   711
UA4                 X    0000B8       1   712
UA6                 X    0000EC       8   721
WAIT                3    002130       8   317  309
ZMKFAILA            F    0000F8       8   723
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    25

 MACRO    DEFN  REFERENCES

ARCHIND     96
ARCHLVL     95
ASAIPL     152
ASALOAD    140
ASAREA     624
TRAP64     142   145
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    26

   DESC     SYMBOL  SIZE    POS       ADDR

Entry: 0

Image      IMAGE    1280  000-4FF  0000-04FF
  Region   ASAREGN   512  000-1FF  0000-01FF
    CSECT  ASASECT   512  000-1FF  0000-01FF
  Region   ECHO      768  200-4FF  2000-22FF
    CSECT  PGMSECT   768  200-4FF  2000-22FF


 ADDR    POS                                OBJECT CONTENT                                         CHARACTER CONTENT


Region: ASAREGN

000000   000   00000000 00002000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
000020   020   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
000040   040   00000000 00000000 00000000 00000000  00000000 00000000 00020000 00000018   |................ ................|
000060   060   00020000 00000020 00020000 00000028  00020000 00000030 00020000 00000038   |................ ................|
000080   080   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
0000A0   0A0   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
0000C0   0C0   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
0000E0   0E0   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
000100   100   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
000120   120   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
000140   140   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
000160   160   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
000180   180   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
0001A0   1A0   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
0001C0   1C0   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
0001E0   1E0   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|

Region: ECHO

002000   200   05C04810 C2069D00 10004710 C2884720  C29A4740 C2DC9201 C20E9200 C234D24E   |....B.......Bh.. B.. B.k.B.k.B.K+|
002020   220   C235C234 4120C1D6 45F0C0C0 47F0C084  47F0C014 4830C20A 4B300046 4780C06C   |B.B...AO.0...0.d .0....B........%|
002040   240   4930C20C 4770C050 D503C230 C2344780  C2849202 C20E4030 C1FC4120 C1F645F0   |..B....&N.B.B... Bdk.B. .A...A6.0|
002060   260   C0C047F0 C01447F0 C01447F0 C0149203  C20E4120 C1FE45F0 C0C047F0 C01447F0   |...0...0...0..k. B...A..0...0...0|
002080   280   C01447F0 C0149205 C20E9680 C20F4120  C1EE45F0 C0C047F0 C09C47F0 C09C45F0   |...0..k.B.o.B... A..0...0...0...0|
0020A0   2A0   C1109180 004447E0 C09C9640 C20F4120  C1E645F0 C0C047F0 C01447F0 C01447F0   |A.j.......o B... AW.0...0...0...0|
0020C0   2C0   C01440B0 C2085020 00489C00 10004710  C2884720 C29A4740 C2DC9D00 10004720   |.. .B.&......... Bh..B.. B.......|
0020E0   2E0   C0D84710 C2884780 C2ACD601 C2080044  9500C209 4770C2D2 91C2C208 4770C2D2   |.Q..Bh..B.O.B... n.B...BKjBB...BK|
002100   300   9104C208 47E0C0D8 9101C208 47E0F008  07FFD207 0078C136 8200C12E D2070078   |j.B....Qj.B...0. ..K...A.b.A.K...|
002120   320   C13E4910 003A078F 47F0C2BE 00000000  F8020000 00000000 00000000 0000211C   |A........0B..... 8...............|
002140   340   00020000 00000038 8200C15E D2070058  C15607FF 00000000 00000000 00000058   |........b.A;K... A...............|
002160   360   00000000 0000214C D2070058 C17650F0  C1828200 C17E0000 00000000 00002188   |.......<K...A.&0 Abb.A=.........h|
002180   380   01000000 00000000 D2070058 C1569140  001B4710 C1988200 00189206 C20E9E00   |........K...A.j  ....Aqb...k.B...|
0021A0   3A0   10004710 C28840B0 C2089D00 10004720  C1A84740 C1BC4780 C1D24710 C288D601   |....Bh .B....... Ay. A...AK..BhO.|
0021C0   3C0   C2080044 9500C209 4770C2D2 910CC208  47E0C1A8 00000000 0100222B 40000007   |B...n.B...BKj.B. ..Ay........ ...|
0021E0   3E0   0A002236 20000050 09002212 0000000B  0900221D 0000000D 09002236 00000000   |.......&........ ................|
002200   400   0100222A 00000001 001F0000 00500004  0000155C 5C40C1E3 E3D5405C 5C155C5C   |.............&.. ...** ATTN **.**|
002220   420   40C3C1D5 C3C5D340 5C5C15C5 D5E3C5D9  7A4098A4 89A30000 00000000 00000000   | CANCEL **.ENTER : quit..........|
002240   440   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    27

 ADDR    POS                                OBJECT CONTENT                                         CHARACTER CONTENT

002260   460   00000000 00000000 00000000 00000000  00000000 00000000 00000000 00000000   |................ ................|
002280   480   00000000 00008200 C2F64010 C2FC9210  C2FBD600 C2FBC20E 8200C2F6 4010C2FC   |......b.B6 .B.k. B.O.B.B.b.B6 .B.|
0022A0   4A0   9220C2FB D600C2FB C20E8200 C2F64010  C2FC9230 C2FBD600 C2FBC20E 8200C2F6   |k.B.O.B.B.b.B6 . B.k.B.O.B.B.b.B6|
0022C0   4C0   D201C2FC 003A9240 C2FBD600 C2FBC20E  8200C2F6 D201C2FC C20847F0 C2E2D201   |K.B...k B.O.B.B. b.B6K.B.B..0BSK.|
0022E0   4E0   C2FC0044 9250C2FB D600C2FB C20E8200  C2F60000 00000000 00020000 00000000   |B...k&B.O.B.B.b. B6..............|
ASMA Ver. 0.2.1  ECHO - PROGRAM TERMINATIONS                                                        07 Nov 2021 10:05:28  Page    28

   STMT                  FILE NAME

1     /home/harold/simh/simh_tests/echo/echo.asm


** NO ERRORS FOUND **

[135] MNOTE *,ARCHLVL - ARCHITECTURE LEVEL SET - 1
